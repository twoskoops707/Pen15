package com.pentest.dashboard

import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton

class InfraredActivity : AppCompatActivity() {

    private lateinit var irOutput: TextView
    private var currentRemoteType = ""

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_infrared)

        irOutput = findViewById(R.id.irOutput)

        findViewById<ImageView>(R.id.btnBack).setOnClickListener { finish() }

        // Remote type buttons
        findViewById<MaterialButton>(R.id.btnTV).setOnClickListener {
            selectRemoteType("TV")
        }

        findViewById<MaterialButton>(R.id.btnAC).setOnClickListener {
            selectRemoteType("Air Conditioner")
        }

        findViewById<MaterialButton>(R.id.btnAudio).setOnClickListener {
            selectRemoteType("Audio System")
        }

        findViewById<MaterialButton>(R.id.btnProjector).setOnClickListener {
            selectRemoteType("Projector")
        }

        // Learn button
        findViewById<MaterialButton>(R.id.btnLearn).setOnClickListener {
            learnRemote()
        }

        // Test button
        findViewById<MaterialButton>(R.id.btnTest).setOnClickListener {
            testSignal()
        }

        // Saved remotes button
        findViewById<MaterialButton>(R.id.btnSavedRemotes).setOnClickListener {
            Toast.makeText(this, "Saved Remotes - Coming soon", Toast.LENGTH_SHORT).show()
        }
    }

    private fun selectRemoteType(type: String) {
        currentRemoteType = type
        addLog("Selected remote type: $type")
        addLog("Loading database...")

        // Simulate loading remote database
        irOutput.postDelayed({
            addLog("Found 127 compatible $type remotes")
            addLog("Ready to transmit")
        }, 800)
    }

    private fun learnRemote() {
        addLog("=== LEARN MODE ACTIVATED ===")
        addLog("Point existing remote at Flipper Zero")
        addLog("Press button on remote to learn...")

        // Simulate learning
        irOutput.postDelayed({
            addLog("Signal captured!")
            addLog("Protocol: NEC")
            addLog("Address: 0x04")
            addLog("Command: 0x08")
        }, 2000)
    }

    private fun testSignal() {
        if (currentRemoteType.isEmpty()) {
            Toast.makeText(this, "Select a remote type first", Toast.LENGTH_SHORT).show()
            return
        }

        addLog("Transmitting IR signal...")
        addLog("Protocol: NEC, Freq: 38kHz")

        irOutput.postDelayed({
            addLog("Signal sent successfully")
        }, 500)
    }

    private fun addLog(message: String) {
        val timestamp = java.text.SimpleDateFormat("HH:mm:ss", java.util.Locale.US)
            .format(java.util.Date())
        val currentLog = irOutput.text.toString()
        val newLog = "[$timestamp] $message\n$currentLog"
        irOutput.text = newLog
    }
}
