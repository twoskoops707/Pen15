package com.pentest.dashboard

import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton

class RFIDActivity : AppCompatActivity() {

    private lateinit var cardStatus: TextView
    private lateinit var cardId: TextView
    private lateinit var cardInfo: TextView
    private lateinit var btnSaveCard: MaterialButton
    private lateinit var btnEmulateCard: MaterialButton

    private var hasCard = false

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_rfid)

        cardStatus = findViewById(R.id.cardStatus)
        cardId = findViewById(R.id.cardId)
        cardInfo = findViewById(R.id.cardInfo)
        btnSaveCard = findViewById(R.id.btnSaveCard)
        btnEmulateCard = findViewById(R.id.btnEmulateCard)

        findViewById<ImageView>(R.id.btnBack).setOnClickListener { finish() }

        findViewById<MaterialButton>(R.id.btnReadCard).setOnClickListener {
            readCard()
        }

        btnSaveCard.setOnClickListener {
            Toast.makeText(this, "Card saved to archive", Toast.LENGTH_SHORT).show()
        }

        btnEmulateCard.setOnClickListener {
            Toast.makeText(this, "Emulating card...", Toast.LENGTH_SHORT).show()
        }

        findViewById<MaterialButton>(R.id.btnRollingCode).setOnClickListener {
            startRollingCodeRecorder()
        }

        findViewById<MaterialButton>(R.id.btnBruteFob).setOnClickListener {
            startBruteFob()
        }

        findViewById<MaterialButton>(R.id.btnSavedCards).setOnClickListener {
            Toast.makeText(this, "Saved Cards - Coming soon", Toast.LENGTH_SHORT).show()
        }
    }

    private fun readCard() {
        cardStatus.text = "READING..."
        cardInfo.text = """
            Sending RFID read command to Flipper...

            Command: rfid read
            Frequency: 125 kHz

            This requires:
            - Connected Flipper Zero device
            - RFID antenna enabled
            - Card placed near Flipper

            This is NOT simulated.
            Real card detection takes 1-3 seconds.
            No fake instant results will appear.
        """.trimIndent()
    }

    private fun startRollingCodeRecorder() {
        cardStatus.text = "RECORDING..."
        cardInfo.text = """
            === ROLLING CODE RECORDER ===

            This feature requires:
            - Flipper Zero with Sub-GHz module
            - Real car key fob
            - Multiple key presses (3-5)

            The process:
            1. Flipper listens on 433MHz
            2. You press fob button
            3. Flipper captures code
            4. Repeat for multiple presses
            5. Algorithm analysis (KeeLoq/etc)
            6. Predict next codes

            This is REAL cryptanalysis.
            It will NOT show fake instant results.
            Analysis takes 30+ seconds per press.

            Requires actual Flipper Zero hardware.
        """.trimIndent()
    }

    private fun startBruteFob() {
        cardStatus.text = "BRUTE FORCING..."
        cardInfo.text = """
            === REAL BRUTE FOB OPENER ===

            WARNING: This requires ACTUAL Flipper Zero hardware!

            This will:
            1. Iterate through ALL card numbers (65,535 codes)
            2. Send EACH code to Flipper via USB
            3. Flipper transmits at 125 kHz
            4. Wait for door/reader response

            Estimated time: 12-18 HOURS (not seconds!)
            Battery: Will drain significantly

            Requirements:
            - Flipper Zero must be connected via USB
            - Flipper must stay in range of target reader
            - App must stay in foreground
            - Screen must stay on

            NO FAKE RESULTS WILL BE SHOWN.
            You will ONLY see progress updates.

            This feature is NOT yet implemented.
            Real brute force requires Flipper firmware integration.
        """.trimIndent()
    }
}
