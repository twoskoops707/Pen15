package com.pentest.dashboard

import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton
import com.google.android.material.card.MaterialCardView

class MainActivity : AppCompatActivity() {

    private lateinit var selectedFunctionTitle: TextView
    private lateinit var selectedFunctionDesc: TextView
    private lateinit var btnExecute: MaterialButton
    private lateinit var statusText: TextView

    private var selectedFunction: String = ""

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        // Initialize views
        selectedFunctionTitle = findViewById(R.id.selectedFunctionTitle)
        selectedFunctionDesc = findViewById(R.id.selectedFunctionDesc)
        btnExecute = findViewById(R.id.btnExecute)
        statusText = findViewById(R.id.statusText)

        // Settings button
        findViewById<ImageView>(R.id.btnSettings).setOnClickListener {
            showSettings()
        }

        // Function button click listeners
        setupFunctionButton(R.id.btnSubGHz, "Sub-GHz Radio",
            "Control 300-928MHz radio signals for garage doors, car remotes, and wireless devices")

        setupFunctionButton(R.id.btnRFID, "RFID Reader",
            "Read and emulate 125kHz RFID access cards and tags")

        setupFunctionButton(R.id.btnNFC, "NFC Reader",
            "Read and emulate 13.56MHz NFC cards and contactless payments")

        setupFunctionButton(R.id.btnInfrared, "Infrared Remote",
            "Control TVs, AC units, and other IR devices")

        setupFunctionButton(R.id.btnGPIO, "GPIO Interface",
            "Connect to hardware via General Purpose Input/Output pins")

        setupFunctionButton(R.id.btnBadUSB, "BadUSB Attack",
            "Emulate keyboard/mouse for automated keystroke injection")

        setupFunctionButton(R.id.btnIButton, "iButton Reader",
            "Read and emulate 1-Wire contact keys")

        setupFunctionButton(R.id.btnBluetooth, "Bluetooth Scanner",
            "Scan and interact with Bluetooth Low Energy devices")

        // Execute button
        btnExecute.setOnClickListener {
            if (selectedFunction.isNotEmpty()) {
                executeFunction(selectedFunction)
            }
        }
    }

    private fun setupFunctionButton(buttonId: Int, title: String, description: String) {
        findViewById<MaterialCardView>(buttonId).setOnClickListener {
            selectFunction(title, description)
        }
    }

    private fun selectFunction(title: String, description: String) {
        selectedFunction = title
        selectedFunctionTitle.text = title
        selectedFunctionDesc.text = description
        btnExecute.visibility = android.view.View.VISIBLE
        btnExecute.text = "EXECUTE: $title"

        Toast.makeText(this, "$title selected", Toast.LENGTH_SHORT).show()
    }

    private fun executeFunction(function: String) {
        // Check if Termux is installed
        val termuxPackage = "com.termux"
        val pm = packageManager

        try {
            pm.getPackageInfo(termuxPackage, 0)

            // Termux is installed - open it
            val intent = pm.getLaunchIntentForPackage(termuxPackage)
            if (intent != null) {
                startActivity(intent)
                Toast.makeText(this, "Opening Termux for $function", Toast.LENGTH_LONG).show()

                // Update status
                statusText.text = "TERMUX READY"
            } else {
                showTermuxNotFound()
            }

        } catch (e: Exception) {
            showTermuxNotFound()
        }
    }

    private fun showTermuxNotFound() {
        Toast.makeText(this,
            "Termux not found!\n\nInstall from F-Droid",
            Toast.LENGTH_LONG).show()

        // Open F-Droid download page
        val intent = Intent(Intent.ACTION_VIEW,
            Uri.parse("https://f-droid.org/en/packages/com.termux/"))
        startActivity(intent)
    }

    private fun showSettings() {
        Toast.makeText(this, "Settings - Coming soon", Toast.LENGTH_SHORT).show()
    }
}
