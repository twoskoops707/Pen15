package com.pentest.dashboard

import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton

class IButtonActivity : AppCompatActivity() {

    private lateinit var keyStatus: TextView
    private lateinit var keyId: TextView
    private lateinit var keyInfo: TextView
    private lateinit var btnWriteKey: MaterialButton
    private lateinit var btnEmulateKey: MaterialButton

    private var hasKey = false

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_ibutton)

        keyStatus = findViewById(R.id.keyStatus)
        keyId = findViewById(R.id.keyId)
        keyInfo = findViewById(R.id.keyInfo)
        btnWriteKey = findViewById(R.id.btnWriteKey)
        btnEmulateKey = findViewById(R.id.btnEmulateKey)

        findViewById<ImageView>(R.id.btnBack).setOnClickListener { finish() }

        findViewById<MaterialButton>(R.id.btnReadKey).setOnClickListener {
            readKey()
        }

        btnWriteKey.setOnClickListener {
            Toast.makeText(this, "Write mode - Coming soon", Toast.LENGTH_SHORT).show()
        }

        btnEmulateKey.setOnClickListener {
            Toast.makeText(this, "Emulating iButton key...", Toast.LENGTH_SHORT).show()
        }

        findViewById<MaterialButton>(R.id.btnSavedKeys).setOnClickListener {
            Toast.makeText(this, "Saved Keys - Coming soon", Toast.LENGTH_SHORT).show()
        }
    }

    private fun readKey() {
        keyStatus.text = "READING..."
        keyInfo.text = "Detecting 1-Wire device..."

        // Simulate key read
        keyStatus.postDelayed({
            hasKey = true
            keyStatus.text = "KEY FOUND"
            keyId.text = "ID: 01:3A:2F:1B:00:00:00:C4"
            keyInfo.text = """
                Type: Dallas DS1990A
                Family Code: 01
                Serial: 3A:2F:1B:00:00:00
                CRC: C4

                1-Wire Protocol: Verified
                Format: Standard iButton

                Use cases:
                - Access control systems
                - Time clocks
                - Security gates

                Compatible: Yes
            """.trimIndent()

            btnWriteKey.isEnabled = true
            btnEmulateKey.isEnabled = true
        }, 1500)
    }
}
