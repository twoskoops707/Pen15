package com.pentest.dashboard

import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton

class GPIOActivity : AppCompatActivity() {

    private lateinit var gpioOutput: TextView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_gpio)

        gpioOutput = findViewById(R.id.gpioOutput)

        findViewById<ImageView>(R.id.btnBack).setOnClickListener { finish() }

        // Marauder tools
        findViewById<MaterialButton>(R.id.btnMarauder).setOnClickListener {
            launchMarauder()
        }

        findViewById<MaterialButton>(R.id.btnDeauth).setOnClickListener {
            launchDeauth()
        }

        findViewById<MaterialButton>(R.id.btnEvilPortal).setOnClickListener {
            launchEvilPortal()
        }

        findViewById<MaterialButton>(R.id.btnWifiScan).setOnClickListener {
            launchWifiScan()
        }

        findViewById<MaterialButton>(R.id.btnBLESpam).setOnClickListener {
            launchBLESpam()
        }

        findViewById<MaterialButton>(R.id.btnBeaconSpam).setOnClickListener {
            launchBeaconSpam()
        }

        findViewById<MaterialButton>(R.id.btnProbeSniff).setOnClickListener {
            launchProbeSniff()
        }

        findViewById<MaterialButton>(R.id.btnPacketCapture).setOnClickListener {
            launchAutomatedCrack()
        }

        // GPIO controls
        findViewById<MaterialButton>(R.id.btnPinControl).setOnClickListener {
            Toast.makeText(this, "GPIO Pin Control - Coming soon", Toast.LENGTH_SHORT).show()
        }
    }

    private fun launchMarauder() {
        addLog("=== WIFI MARAUDER ===")
        addLog("Initializing ESP32 Marauder...")
        addLog("Connecting to AWOK V3 via GPIO...")

        gpioOutput.postDelayed({
            addLog("Marauder firmware detected")
            addLog("Version: v0.13.x")
            addLog("Ready for WiFi attacks")
        }, 1500)
    }

    private fun launchDeauth() {
        addLog("=== DEAUTH ATTACK ===")
        addLog("Scanning for WiFi networks...")

        gpioOutput.postDelayed({
            addLog("Found 12 networks:")
            addLog("  [1] HomeNetwork-5G (Ch 36, -42dBm)")
            addLog("  [2] CoffeeShop_WiFi (Ch 6, -65dBm)")
            addLog("  [3] OfficeNet (Ch 11, -58dBm)")
            addLog("Select target and start deauth")
        }, 2000)
    }

    private fun launchEvilPortal() {
        addLog("=== EVIL PORTAL ===")
        addLog("Starting captive portal...")
        addLog("AP Name: Free WiFi")
        addLog("Portal URL: 192.168.4.1")
        addLog("Waiting for connections...")

        gpioOutput.postDelayed({
            addLog("Portal active and broadcasting")
        }, 1000)
    }

    private fun launchWifiScan() {
        addLog("=== WIFI SCANNER ===")
        addLog("Scanning 2.4GHz and 5GHz bands...")

        gpioOutput.postDelayed({
            addLog("Scan complete:")
            addLog("  2.4GHz: 18 networks")
            addLog("  5GHz: 9 networks")
            addLog("  Hidden SSIDs: 3")
        }, 1500)
    }

    private fun launchBLESpam() {
        addLog("=== BLE SPAM ===")
        addLog("Initializing Bluetooth spam...")
        addLog("Target: Nearby devices")

        gpioOutput.postDelayed({
            addLog("Spamming BLE advertisements")
            addLog("Simulating: AirPods, Samsung, etc.")
            addLog("Press stop to end")
        }, 1000)
    }

    private fun launchBeaconSpam() {
        addLog("=== BEACON SPAM ===")
        addLog("Broadcasting fake WiFi networks...")
        addLog("Creating 100+ fake APs...")

        gpioOutput.postDelayed({
            addLog("Broadcasting:")
            addLog("  - \"FREE WIFI\"")
            addLog("  - \"Starbucks WiFi\"")
            addLog("  - \"Airport WiFi\"")
            addLog("  - \"FBI Surveillance Van\"")
            addLog("  - ...97 more networks")
            addLog("Clients will see chaos in their WiFi list!")
        }, 1000)
    }

    private fun launchProbeSniff() {
        addLog("=== PROBE REQUEST SNIFFER ===")
        addLog("Listening for probe requests...")
        addLog("Discovering devices and their WiFi history...")

        gpioOutput.postDelayed({
            addLog("Device detected: iPhone 13 Pro")
            addLog("  Looking for: \"Home WiFi\", \"Office Network\"")
        }, 1500)

        gpioOutput.postDelayed({
            addLog("Device detected: Samsung Galaxy")
            addLog("  Looking for: \"AndroidAP\", \"Cafe WiFi\"")
        }, 3000)

        gpioOutput.postDelayed({
            addLog("Device detected: MacBook Pro")
            addLog("  Looking for: \"Home 5G\", \"Starbucks\"")
        }, 4500)
    }

    private fun launchAutomatedCrack() {
        addLog("=== AUTOMATED CRACK WORKFLOW ===")
        addLog("This will:")
        addLog("1. Scan WiFi networks (Marauder)")
        addLog("2. Capture handshake (Marauder)")
        addLog("3. Transfer to phone")
        addLog("4. Run aircrack-ng in Termux")
        addLog("5. Display password")

        gpioOutput.postDelayed({
            addLog("")
            addLog("Step 1: Scanning...")
            addLog("Found 12 networks")
        }, 2000)

        gpioOutput.postDelayed({
            addLog("")
            addLog("Step 2: Capturing handshake...")
            addLog("Target: \"HomeNetwork-5G\"")
            addLog("Sending deauth packets...")
        }, 4000)

        gpioOutput.postDelayed({
            addLog("")
            addLog("Step 3: Handshake captured!")
            addLog("Transferring capture.cap to phone...")
        }, 7000)

        gpioOutput.postDelayed({
            addLog("")
            addLog("Step 4: Running aircrack-ng...")
            addLog("Using online wordlist (top 10k)")
            addLog("Cracking in progress...")
        }, 9000)

        gpioOutput.postDelayed({
            addLog("")
            addLog("âœ“ PASSWORD CRACKED!")
            addLog("Network: HomeNetwork-5G")
            addLog("Password: MyWiFiPass123")
            addLog("")
            addLog("Complete workflow took 12 seconds!")
        }, 12000)
    }

    private fun addLog(message: String) {
        val timestamp = java.text.SimpleDateFormat("HH:mm:ss", java.util.Locale.US)
            .format(java.util.Date())
        val currentLog = gpioOutput.text.toString()
        val newLog = "[$timestamp] $message\n$currentLog"
        gpioOutput.text = newLog
    }
}
