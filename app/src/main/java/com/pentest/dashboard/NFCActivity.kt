package com.pentest.dashboard

import android.os.Bundle
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.button.MaterialButton

class NFCActivity : AppCompatActivity() {

    private lateinit var tagStatus: TextView
    private lateinit var tagUid: TextView
    private lateinit var tagInfo: TextView
    private lateinit var btnWriteTag: MaterialButton
    private lateinit var btnEmulateTag: MaterialButton

    private var hasTag = false

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_nfc)

        tagStatus = findViewById(R.id.tagStatus)
        tagUid = findViewById(R.id.tagUid)
        tagInfo = findViewById(R.id.tagInfo)
        btnWriteTag = findViewById(R.id.btnWriteTag)
        btnEmulateTag = findViewById(R.id.btnEmulateTag)

        findViewById<ImageView>(R.id.btnBack).setOnClickListener { finish() }

        findViewById<MaterialButton>(R.id.btnReadTag).setOnClickListener {
            readTag()
        }

        btnWriteTag.setOnClickListener {
            Toast.makeText(this, "Write mode - Coming soon", Toast.LENGTH_SHORT).show()
        }

        btnEmulateTag.setOnClickListener {
            Toast.makeText(this, "Emulating NFC tag...", Toast.LENGTH_SHORT).show()
        }

        findViewById<MaterialButton>(R.id.btnSavedTags).setOnClickListener {
            Toast.makeText(this, "Saved Tags - Coming soon", Toast.LENGTH_SHORT).show()
        }
    }

    private fun readTag() {
        tagStatus.text = "READING..."
        tagInfo.text = "Scanning for 13.56 MHz NFC signal..."

        // Simulate tag read
        tagStatus.postDelayed({
            hasTag = true
            tagStatus.text = "TAG FOUND"
            tagUid.text = "UID: 04:A2:3B:1C:9F:28:80"
            tagInfo.text = """
                Type: MIFARE Classic 1K
                UID: 04:A2:3B:1C:9F:28:80
                SAK: 08
                ATQA: 00 04

                Memory: 1024 bytes (16 sectors)
                Format: ISO/IEC 14443 Type A

                Block 0: 04 A2 3B 1C 9F 28 80

                Compatible: Yes
            """.trimIndent()

            btnWriteTag.isEnabled = true
            btnEmulateTag.isEnabled = true
        }, 1500)
    }
}
